name: zzzzzzz

on:
  push:

defaults:
  run:
    shell: bash

env:
  LINK: https://mega.nz/file/I81DRJwC#hiTFHmr78kmemnw9QMKpHCUSKYq1DAou7cqv10m2P44
  LOGO: https://telegra.ph/file/d1ca85aac5234d7ed90f2.jpg
  GAME_NAME: 𝗧𝗵𝗲 𝗚𝗲𝗻𝗲𝘀𝗶𝘀 𝗢𝗿𝗱𝗲𝗿 [𝘃.𝟳𝟳𝟬𝟲𝟭] [𝗡𝗟𝗧 𝗠𝗲𝗱𝗶𝗮]
  UPLOAD: asoy-gaming
  TZ: Asia/Jakarta

jobs:
  deploy-android:
    name: Asoy-Gaming
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      
      - name: Setup SSH 💻
        uses: fastai/workflows/ssh@master
        with:
          ssh_key: ${{ secrets.KNOWN_HOSTS }}
          key_file: known_hosts
        env:
          KNOWN_HOSTS: ${{ secrets.KNOWN_HOSTS }}

      - name: Install MegaCmd ⏳
        run: |
          curl https://mega.nz/linux/MEGAsync/xUbuntu_20.04/amd64/megacmd_1.5.1-1.1_amd64.deb --output megacmd.deb
          chmod +x megacmd.deb
          sudo apt install ./megacmd.deb -y

      - name: Download 📥
        run: |
          mega-get ${LINK} $PWD

      - name: Upload 📤
        run: |
          cd $PWD
          sshpass -p ${SF_PASSWORD} scp *.apk ${SF_USERNAME}@frs.sourceforge.net:/home/frs/project/${UPLOAD}
        env:
          SF_USERNAME: ${{ secrets.SF_USER }}
          SF_PASSWORD: ${{ secrets.SF_PASWORD }}

      - name: Release 📝
        run: |
          LINK_MIRROR="https://semawur.com/st/?api=12009627cdbda7809f8aa8a75007ec876ac0503c&url=https://sourceforge.net/projects/${UPLOAD}/files/$(cd $PWD && ls *apk)/download"
          telegram_message() {
               curl -v "https://api.telegram.org/bot""$TG_TOKEN""/sendPhoto?chat_id=""$TG_ID""$ARGS_EXTRA" -H 'Content-Type: multipart/form-data' \
               --form photo="$LOGO" \
               -F "parse_mode=html" \
               -F caption="$1"
          }
          TG_TEXT="$(< tg.html)"
          telegram_message "$TG_TEXT"
        env:
          TG_TOKEN: ${{ secrets.TG_TOKEN }}
          TG_ID: ${{ secrets.TG_ID }}
